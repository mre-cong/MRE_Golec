<!DOCTYPE html>
<!-- Generated by Cython 0.29.33 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: get_volume_correction_force_cy.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.33</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="get_volume_correction_force_cy.c">get_volume_correction_force_cy.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">01</span>: # -*- coding: utf-8 -*-</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">02</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">03</span>: Created on Mon Jan 23 10:46:56 2023</pre>
<pre class="cython line score-0">&#xA0;<span class="">04</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">05</span>: @author: bagaw</pre>
<pre class="cython line score-0">&#xA0;<span class="">06</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">07</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">08</span>: cimport cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">09</span>: #volume correction force calculation. I need to calculate all the forces acting on each vertex (or gradient of the energy wrt the vertex position, which is the negative of the force vector acting on the vertex). I can write this to work for a single unit cell at first, but I need to think about how I will store the forces before I add them up, and assign them to the correct vertices.</pre>
<pre class="cython line score-0">&#xA0;<span class="">10</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">11</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-84" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">12</span>: cpdef get_volume_correction_force(int[:,:] elements, double[:,:,:] avg_vectors, double kappa, double l_e, double[:,:] correction_force):</pre>
<pre class='cython code score-84 '>static PyObject *__pyx_pw_30get_volume_correction_force_cy_1get_volume_correction_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_30get_volume_correction_force_cy_get_volume_correction_force(__Pyx_memviewslice __pyx_v_elements, __Pyx_memviewslice __pyx_v_avg_vectors, double __pyx_v_kappa, double __pyx_v_l_e, __Pyx_memviewslice __pyx_v_correction_force, CYTHON_UNUSED int __pyx_skip_dispatch) {
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_correction_force_el[8][3];
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_volume_correction_force", 0);
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_7));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.get_volume_correction_force", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_30get_volume_correction_force_cy_1get_volume_correction_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_30get_volume_correction_force_cy_get_volume_correction_force[] = "calculate the volume correction force on each of the vertices of the unit cell of each element. must pass an array for correction_force that will be modified";
static PyObject *__pyx_pw_30get_volume_correction_force_cy_1get_volume_correction_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_elements = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_avg_vectors = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_kappa;
  double __pyx_v_l_e;
  __Pyx_memviewslice __pyx_v_correction_force = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_volume_correction_force (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_elements,&amp;__pyx_n_s_avg_vectors,&amp;__pyx_n_s_kappa,&amp;__pyx_n_s_l_e,&amp;__pyx_n_s_correction_force,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_elements)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_avg_vectors)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_volume_correction_force", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_kappa)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_volume_correction_force", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_l_e)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_volume_correction_force", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_correction_force)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_volume_correction_force", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_volume_correction_force") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_elements = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_elements.memview)) __PYX_ERR(0, 12, __pyx_L3_error)</span>
    __pyx_v_avg_vectors = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_avg_vectors.memview)) __PYX_ERR(0, 12, __pyx_L3_error)</span>
    __pyx_v_kappa = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_kappa == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
    __pyx_v_l_e = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_l_e == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
    __pyx_v_correction_force = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_correction_force.memview)) __PYX_ERR(0, 12, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_volume_correction_force", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.get_volume_correction_force", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_30get_volume_correction_force_cy_get_volume_correction_force(__pyx_self, __pyx_v_elements, __pyx_v_avg_vectors, __pyx_v_kappa, __pyx_v_l_e, __pyx_v_correction_force);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_30get_volume_correction_force_cy_get_volume_correction_force(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_elements, __Pyx_memviewslice __pyx_v_avg_vectors, double __pyx_v_kappa, double __pyx_v_l_e, __Pyx_memviewslice __pyx_v_correction_force) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_volume_correction_force", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_elements.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("elements"); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span> }
  if (unlikely(!__pyx_v_avg_vectors.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("avg_vectors"); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span> }
  if (unlikely(!__pyx_v_correction_force.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("correction_force"); <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span> }
  __pyx_t_1 = __pyx_f_30get_volume_correction_force_cy_get_volume_correction_force(__pyx_v_elements, __pyx_v_avg_vectors, __pyx_v_kappa, __pyx_v_l_e, __pyx_v_correction_force, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 12, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.get_volume_correction_force", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_elements, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_avg_vectors, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_correction_force, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">13</span>:     """calculate the volume correction force on each of the vertices of the unit cell of each element. must pass an array for correction_force that will be modified"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">14</span>:     cdef int i</pre>
<pre class="cython line score-0">&#xA0;<span class="">15</span>:     cdef int j</pre>
<pre class="cython line score-0">&#xA0;<span class="">16</span>:     cdef double correction_force_el[8][3]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">17</span>:     for i in range(8):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 8; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">18</span>:         for j in range(3):</pre>
<pre class='cython code score-0 '>    for (__pyx_t_2 = 0; __pyx_t_2 &lt; 3; __pyx_t_2+=1) {
      __pyx_v_j = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">19</span>:             correction_force_el[i][j] = 0.0</pre>
<pre class='cython code score-0 '>      ((__pyx_v_correction_force_el[__pyx_v_i])[__pyx_v_j]) = 0.0;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">20</span>:     # iterating over elements, get an 8x3 array, then add to each entry in the correction_force array by iterating over j, getting the index from elements[i,j] (the jth node of the ith element), where correction_force_el[j,0] is the x component of the jth node due to the volume correction force</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">21</span>:     for i in range(elements.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_elements.shape[0]);
  __pyx_t_4 = __pyx_t_3;
  for (__pyx_t_1 = 0; __pyx_t_1 &lt; __pyx_t_4; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">22</span>:         get_volume_correction_force_el(elements[i,:], avg_vectors[:,:,i], kappa, l_e,correction_force_el)</pre>
<pre class='cython code score-6 '>    __pyx_t_5.data = __pyx_v_elements.data;
    __pyx_t_5.memview = __pyx_v_elements.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_5, 0);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_elements.strides[0];
        __pyx_t_5.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_5.shape[0] = __pyx_v_elements.shape[1];
__pyx_t_5.strides[0] = __pyx_v_elements.strides[1];
    __pyx_t_5.suboffsets[0] = -1;

__pyx_t_6.data = __pyx_v_avg_vectors.data;
    __pyx_t_6.memview = __pyx_v_avg_vectors.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_6, 0);
    __pyx_t_6.shape[0] = __pyx_v_avg_vectors.shape[0];
__pyx_t_6.strides[0] = __pyx_v_avg_vectors.strides[0];
    __pyx_t_6.suboffsets[0] = -1;

__pyx_t_6.shape[1] = __pyx_v_avg_vectors.shape[1];
__pyx_t_6.strides[1] = __pyx_v_avg_vectors.strides[1];
    __pyx_t_6.suboffsets[1] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vectors.strides[2];
        __pyx_t_6.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_9 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_8 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)8), ((Py_ssize_t)3));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_7 = __pyx_array_new(__pyx_t_8, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_9), (char *) "c", (char *) __pyx_v_correction_force_el);
    if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_t_7), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
    __pyx_f_30get_volume_correction_force_cy_get_volume_correction_force_el(__pyx_t_5, __pyx_t_6, __pyx_v_kappa, __pyx_v_l_e, __pyx_t_10);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
    __pyx_t_5.memview = NULL;
    __pyx_t_5.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
    __pyx_t_6.memview = NULL;
    __pyx_t_6.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
    __pyx_t_10.memview = NULL;
    __pyx_t_10.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">23</span>:         for j in range(8):</pre>
<pre class='cython code score-0 '>    for (__pyx_t_2 = 0; __pyx_t_2 &lt; 8; __pyx_t_2+=1) {
      __pyx_v_j = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">24</span>:             correction_force[elements[i,j]][0] += correction_force_el[j][0]</pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_12 = __pyx_v_j;
      __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_elements.data + __pyx_t_11 * __pyx_v_elements.strides[0]) ) + __pyx_t_12 * __pyx_v_elements.strides[1]) )));
      __pyx_t_14 = 0;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_13 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_14 * __pyx_v_correction_force.strides[1]) )) += ((__pyx_v_correction_force_el[__pyx_v_j])[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">25</span>:             correction_force[elements[i,j]][1] += correction_force_el[j][1]</pre>
<pre class='cython code score-0 '>      __pyx_t_12 = __pyx_v_i;
      __pyx_t_11 = __pyx_v_j;
      __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_elements.data + __pyx_t_12 * __pyx_v_elements.strides[0]) ) + __pyx_t_11 * __pyx_v_elements.strides[1]) )));
      __pyx_t_13 = 1;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_14 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_13 * __pyx_v_correction_force.strides[1]) )) += ((__pyx_v_correction_force_el[__pyx_v_j])[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">26</span>:             correction_force[elements[i,j]][2] += correction_force_el[j][2]</pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_12 = __pyx_v_j;
      __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_elements.data + __pyx_t_11 * __pyx_v_elements.strides[0]) ) + __pyx_t_12 * __pyx_v_elements.strides[1]) )));
      __pyx_t_14 = 2;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_13 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_14 * __pyx_v_correction_force.strides[1]) )) += ((__pyx_v_correction_force_el[__pyx_v_j])[2]);
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">27</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">28</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">29</span>: #let's create a cdef function that returns the volume correction forces on the nodes of a single element, and call that from the cpdef function that we will call in the python script to get the volume correction force on each object. I should also write a cdef cross function, since that takes up a significant portion of the volume correction force calculation according to the profiler results. I should try writing some example cython functions first before trying to convert these things. I also need to make sure i set up a git repository, or ensure i am using the one i had already set up rather than continuing to do things without a record. try writing the cross product function and compare the results to the numpy function to ensure the result is correct.</pre>
<pre class="cython line score-0">&#xA0;<span class="">30</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">31</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">32</span>: cdef void get_volume_correction_force_el(int[:] element, double[:,:] avg_vec, double kappa, double l_e, double[:,:] correction_force):</pre>
<pre class='cython code score-7 '>static void __pyx_f_30get_volume_correction_force_cy_get_volume_correction_force_el(CYTHON_UNUSED __Pyx_memviewslice __pyx_v_element, __Pyx_memviewslice __pyx_v_avg_vec, double __pyx_v_kappa, double __pyx_v_l_e, __Pyx_memviewslice __pyx_v_correction_force) {
  double __pyx_v_acrossb[3];
  double __pyx_v_bcrossc[3];
  double __pyx_v_ccrossa[3];
  double __pyx_v_adotbcrossc;
  double __pyx_v_gradV1[3];
  double __pyx_v_gradV8[3];
  double __pyx_v_gradV3[3];
  double __pyx_v_gradV6[3];
  double __pyx_v_gradV7[3];
  double __pyx_v_gradV2[3];
  double __pyx_v_gradV5[3];
  double __pyx_v_gradV4[3];
  int __pyx_v_i;
  double __pyx_v_prefactor;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_volume_correction_force_el", 0);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("get_volume_correction_force_cy.get_volume_correction_force_el", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">33</span>:     cdef double[3] acrossb = cross_prod(avg_vec[0,:],avg_vec[1,:])</pre>
<pre class='cython code score-1 '>  __pyx_t_1.data = __pyx_v_avg_vec.data;
  __pyx_t_1.memview = __pyx_v_avg_vec.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_1, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vec.strides[0];
        __pyx_t_1.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_1.shape[0] = __pyx_v_avg_vec.shape[1];
__pyx_t_1.strides[0] = __pyx_v_avg_vec.strides[1];
    __pyx_t_1.suboffsets[0] = -1;

__pyx_t_2.data = __pyx_v_avg_vec.data;
  __pyx_t_2.memview = __pyx_v_avg_vec.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_2, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 1;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vec.strides[0];
        __pyx_t_2.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_2.shape[0] = __pyx_v_avg_vec.shape[1];
__pyx_t_2.strides[0] = __pyx_v_avg_vec.strides[1];
    __pyx_t_2.suboffsets[0] = -1;

__pyx_t_3 = __pyx_f_30get_volume_correction_force_cy_cross_prod(__pyx_t_1, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
  if (unlikely(__Pyx_carray_from_py_double(__pyx_t_3, __pyx_t_4, 3) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  memcpy(&amp;(__pyx_v_acrossb[0]), __pyx_t_4, sizeof(__pyx_v_acrossb[0]) * (3));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">34</span>:     cdef double[3] bcrossc = cross_prod(avg_vec[1,:],avg_vec[2,:])</pre>
<pre class='cython code score-1 '>  __pyx_t_2.data = __pyx_v_avg_vec.data;
  __pyx_t_2.memview = __pyx_v_avg_vec.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_2, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 1;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vec.strides[0];
        __pyx_t_2.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_2.shape[0] = __pyx_v_avg_vec.shape[1];
__pyx_t_2.strides[0] = __pyx_v_avg_vec.strides[1];
    __pyx_t_2.suboffsets[0] = -1;

__pyx_t_1.data = __pyx_v_avg_vec.data;
  __pyx_t_1.memview = __pyx_v_avg_vec.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_1, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 2;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vec.strides[0];
        __pyx_t_1.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_1.shape[0] = __pyx_v_avg_vec.shape[1];
__pyx_t_1.strides[0] = __pyx_v_avg_vec.strides[1];
    __pyx_t_1.suboffsets[0] = -1;

__pyx_t_3 = __pyx_f_30get_volume_correction_force_cy_cross_prod(__pyx_t_2, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  if (unlikely(__Pyx_carray_from_py_double(__pyx_t_3, __pyx_t_4, 3) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  memcpy(&amp;(__pyx_v_bcrossc[0]), __pyx_t_4, sizeof(__pyx_v_bcrossc[0]) * (3));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">35</span>:     cdef double[3] ccrossa = cross_prod(avg_vec[2,:],avg_vec[0,:])</pre>
<pre class='cython code score-1 '>  __pyx_t_1.data = __pyx_v_avg_vec.data;
  __pyx_t_1.memview = __pyx_v_avg_vec.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_1, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 2;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vec.strides[0];
        __pyx_t_1.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_1.shape[0] = __pyx_v_avg_vec.shape[1];
__pyx_t_1.strides[0] = __pyx_v_avg_vec.strides[1];
    __pyx_t_1.suboffsets[0] = -1;

__pyx_t_2.data = __pyx_v_avg_vec.data;
  __pyx_t_2.memview = __pyx_v_avg_vec.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_2, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vec.strides[0];
        __pyx_t_2.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_2.shape[0] = __pyx_v_avg_vec.shape[1];
__pyx_t_2.strides[0] = __pyx_v_avg_vec.strides[1];
    __pyx_t_2.suboffsets[0] = -1;

__pyx_t_3 = __pyx_f_30get_volume_correction_force_cy_cross_prod(__pyx_t_1, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 35, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
  if (unlikely(__Pyx_carray_from_py_double(__pyx_t_3, __pyx_t_4, 3) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 35, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  memcpy(&amp;(__pyx_v_ccrossa[0]), __pyx_t_4, sizeof(__pyx_v_ccrossa[0]) * (3));
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">36</span>:     cdef double adotbcrossc = dot_prod(avg_vec[0,:],bcrossc)</pre>
<pre class='cython code score-6 '>  __pyx_t_2.data = __pyx_v_avg_vec.data;
  __pyx_t_2.memview = __pyx_v_avg_vec.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_2, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_avg_vec.strides[0];
        __pyx_t_2.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_2.shape[0] = __pyx_v_avg_vec.shape[1];
__pyx_t_2.strides[0] = __pyx_v_avg_vec.strides[1];
    __pyx_t_2.suboffsets[0] = -1;

__pyx_t_6 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_3 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)3));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 36, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = __pyx_array_new(__pyx_t_3, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_6), (char *) "fortran", (char *) __pyx_v_bcrossc);
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 36, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_5), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 36, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  __pyx_v_adotbcrossc = __pyx_f_30get_volume_correction_force_cy_dot_prod(__pyx_t_2, __pyx_t_1, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">37</span>:     cdef double[3] gradV1</pre>
<pre class="cython line score-0">&#xA0;<span class="">38</span>:     cdef double[3] gradV8</pre>
<pre class="cython line score-0">&#xA0;<span class="">39</span>:     cdef double[3] gradV3</pre>
<pre class="cython line score-0">&#xA0;<span class="">40</span>:     cdef double[3] gradV6</pre>
<pre class="cython line score-0">&#xA0;<span class="">41</span>:     cdef double[3] gradV7</pre>
<pre class="cython line score-0">&#xA0;<span class="">42</span>:     cdef double[3] gradV2</pre>
<pre class="cython line score-0">&#xA0;<span class="">43</span>:     cdef double[3] gradV5</pre>
<pre class="cython line score-0">&#xA0;<span class="">44</span>:     cdef double[3] gradV4</pre>
<pre class="cython line score-0">&#xA0;<span class="">45</span>:     cdef int i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">46</span>:     for i in range(3):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_7 = 0; __pyx_t_7 &lt; 3; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">47</span>:         gradV1[i] = -1*bcrossc[i] -1*ccrossa[i] -1*acrossb[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV1[__pyx_v_i]) = (((-1.0 * (__pyx_v_bcrossc[__pyx_v_i])) - (1.0 * (__pyx_v_ccrossa[__pyx_v_i]))) - (1.0 * (__pyx_v_acrossb[__pyx_v_i])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">48</span>:         gradV8[i] = -1*gradV1[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV8[__pyx_v_i]) = (-1.0 * (__pyx_v_gradV1[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">49</span>:         gradV3[i] = bcrossc[i] -1*ccrossa[i] -1*acrossb[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV3[__pyx_v_i]) = (((__pyx_v_bcrossc[__pyx_v_i]) - (1.0 * (__pyx_v_ccrossa[__pyx_v_i]))) - (1.0 * (__pyx_v_acrossb[__pyx_v_i])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">50</span>:         gradV6[i] = -1*gradV3[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV6[__pyx_v_i]) = (-1.0 * (__pyx_v_gradV3[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">51</span>:         gradV7[i] = bcrossc[i] + ccrossa[i] -1*acrossb[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV7[__pyx_v_i]) = (((__pyx_v_bcrossc[__pyx_v_i]) + (__pyx_v_ccrossa[__pyx_v_i])) - (1.0 * (__pyx_v_acrossb[__pyx_v_i])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">52</span>:         gradV2[i] = -1*gradV7[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV2[__pyx_v_i]) = (-1.0 * (__pyx_v_gradV7[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">53</span>:         gradV5[i] = -1*bcrossc[i] + ccrossa[i] -1*acrossb[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV5[__pyx_v_i]) = (((-1.0 * (__pyx_v_bcrossc[__pyx_v_i])) + (__pyx_v_ccrossa[__pyx_v_i])) - (1.0 * (__pyx_v_acrossb[__pyx_v_i])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">54</span>:         gradV4[i] = -1*gradV5[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_gradV4[__pyx_v_i]) = (-1.0 * (__pyx_v_gradV5[__pyx_v_i]));
  }
</pre><pre class="cython line score-47" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">55</span>:     cdef double prefactor = -kappa * ((1/pow(l_e,3) * adotbcrossc - 1))</pre>
<pre class='cython code score-47 '>  __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((-__pyx_v_kappa));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_l_e);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_8 = __Pyx_PyNumber_Power2(__pyx_t_3, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_adotbcrossc);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractObjC</span>(__pyx_t_9, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_9); if (unlikely((__pyx_t_10 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_v_prefactor = __pyx_t_10;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">56</span>:     for i in range(3):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_7 = 0; __pyx_t_7 &lt; 3; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">57</span>:         correction_force[0][i] = prefactor*gradV1[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 0;
    __pyx_t_12 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_11 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_12 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV1[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">58</span>:         correction_force[1][i] = prefactor*gradV2[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 1;
    __pyx_t_11 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_12 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_11 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV2[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">59</span>:         correction_force[2][i] = prefactor*gradV3[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 2;
    __pyx_t_12 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_11 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_12 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV3[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">60</span>:         correction_force[3][i] = prefactor*gradV4[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 3;
    __pyx_t_11 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_12 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_11 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV4[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">61</span>:         correction_force[4][i] = prefactor*gradV5[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 4;
    __pyx_t_12 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_11 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_12 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV5[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">62</span>:         correction_force[5][i] = prefactor*gradV6[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 5;
    __pyx_t_11 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_12 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_11 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV6[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">63</span>:         correction_force[6][i] = prefactor*gradV7[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 6;
    __pyx_t_12 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_11 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_12 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV7[__pyx_v_i]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">64</span>:         correction_force[7][i] = prefactor*gradV8[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 7;
    __pyx_t_11 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_correction_force.data + __pyx_t_12 * __pyx_v_correction_force.strides[0]) ) + __pyx_t_11 * __pyx_v_correction_force.strides[1]) )) = (__pyx_v_prefactor * (__pyx_v_gradV8[__pyx_v_i]));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">65</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">66</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">67</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">68</span>: cpdef cross_prod(double[:] vec1, double[:] vec2):</pre>
<pre class='cython code score-39 '>static PyObject *__pyx_pw_30get_volume_correction_force_cy_3cross_prod(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_30get_volume_correction_force_cy_cross_prod(__Pyx_memviewslice __pyx_v_vec1, __Pyx_memviewslice __pyx_v_vec2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_result[3];
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cross_prod", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.cross_prod", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_30get_volume_correction_force_cy_3cross_prod(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_30get_volume_correction_force_cy_3cross_prod(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_vec1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_vec2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cross_prod (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vec1,&amp;__pyx_n_s_vec2,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_vec1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_vec2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cross_prod", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cross_prod") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_vec1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vec1.memview)) __PYX_ERR(0, 68, __pyx_L3_error)</span>
    __pyx_v_vec2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vec2.memview)) __PYX_ERR(0, 68, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cross_prod", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.cross_prod", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_30get_volume_correction_force_cy_2cross_prod(__pyx_self, __pyx_v_vec1, __pyx_v_vec2);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_30get_volume_correction_force_cy_2cross_prod(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_vec1, __Pyx_memviewslice __pyx_v_vec2) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cross_prod", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_vec1.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("vec1"); <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L1_error)</span> }
  if (unlikely(!__pyx_v_vec2.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("vec2"); <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L1_error)</span> }
  __pyx_t_1 = __pyx_f_30get_volume_correction_force_cy_cross_prod(__pyx_v_vec1, __pyx_v_vec2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.cross_prod", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_vec1, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_vec2, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">69</span>:     cdef double result[3]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">70</span>:     result[0] = vec1[1]*vec2[2] - vec1[2]*vec2[1]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1;
  __pyx_t_2 = 2;
  __pyx_t_3 = 2;
  __pyx_t_4 = 1;
  (__pyx_v_result[0]) = (((*((double *) ( /* dim=0 */ (__pyx_v_vec1.data + __pyx_t_1 * __pyx_v_vec1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec2.data + __pyx_t_2 * __pyx_v_vec2.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_vec1.data + __pyx_t_3 * __pyx_v_vec1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec2.data + __pyx_t_4 * __pyx_v_vec2.strides[0]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">71</span>:     result[1] = vec1[2]*vec2[0] - vec1[0]*vec2[2]</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = 2;
  __pyx_t_3 = 0;
  __pyx_t_2 = 0;
  __pyx_t_1 = 2;
  (__pyx_v_result[1]) = (((*((double *) ( /* dim=0 */ (__pyx_v_vec1.data + __pyx_t_4 * __pyx_v_vec1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec2.data + __pyx_t_3 * __pyx_v_vec2.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_vec1.data + __pyx_t_2 * __pyx_v_vec1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec2.data + __pyx_t_1 * __pyx_v_vec2.strides[0]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">72</span>:     result[2] = vec1[0]*vec2[1] - vec1[1]*vec2[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_t_3 = 1;
  __pyx_t_4 = 0;
  (__pyx_v_result[2]) = (((*((double *) ( /* dim=0 */ (__pyx_v_vec1.data + __pyx_t_1 * __pyx_v_vec1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec2.data + __pyx_t_2 * __pyx_v_vec2.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_vec1.data + __pyx_t_3 * __pyx_v_vec1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec2.data + __pyx_t_4 * __pyx_v_vec2.strides[0]) )))));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">73</span>:     return result</pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = __Pyx_carray_to_py_double(__pyx_v_result, 3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">74</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">75</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">76</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">77</span>: cpdef double dot_prod(double[:] vec1, double[:] vec2):</pre>
<pre class='cython code score-41 '>static PyObject *__pyx_pw_30get_volume_correction_force_cy_5dot_prod(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static double __pyx_f_30get_volume_correction_force_cy_dot_prod(__Pyx_memviewslice __pyx_v_vec1, __Pyx_memviewslice __pyx_v_vec2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_result;
  int __pyx_v_i;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dot_prod", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_30get_volume_correction_force_cy_5dot_prod(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_30get_volume_correction_force_cy_5dot_prod(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_vec1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_vec2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dot_prod (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vec1,&amp;__pyx_n_s_vec2,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_vec1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_vec2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dot_prod", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 77, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dot_prod") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 77, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_vec1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vec1.memview)) __PYX_ERR(0, 77, __pyx_L3_error)</span>
    __pyx_v_vec2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vec2.memview)) __PYX_ERR(0, 77, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dot_prod", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 77, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.dot_prod", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_30get_volume_correction_force_cy_4dot_prod(__pyx_self, __pyx_v_vec1, __pyx_v_vec2);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_30get_volume_correction_force_cy_4dot_prod(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_vec1, __Pyx_memviewslice __pyx_v_vec2) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dot_prod", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_vec1.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("vec1"); <span class='error_goto'>__PYX_ERR(0, 77, __pyx_L1_error)</span> }
  if (unlikely(!__pyx_v_vec2.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("vec2"); <span class='error_goto'>__PYX_ERR(0, 77, __pyx_L1_error)</span> }
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_30get_volume_correction_force_cy_dot_prod(__pyx_v_vec1, __pyx_v_vec2, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("get_volume_correction_force_cy.dot_prod", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_vec1, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_vec2, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">78</span>:     cdef double result = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_result = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">79</span>:     cdef int i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">80</span>:     for i in range(vec1.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_vec1.shape[0]);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">81</span>:         result += vec1[i]*vec2[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_result = (__pyx_v_result + ((*((double *) ( /* dim=0 */ (__pyx_v_vec1.data + __pyx_t_4 * __pyx_v_vec1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec2.data + __pyx_t_5 * __pyx_v_vec2.strides[0]) )))));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">82</span>:     return result</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_result;
  goto __pyx_L0;
</pre></div></body></html>
